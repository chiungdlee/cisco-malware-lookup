terraform {
  backend "azurerm" {
    resource_group_name  = "terraform-backend"
    storage_account_name = "tfstate"
    container_name       = "tfstate"
    key                  = "terraform.tfstate"
  }
}

module "resource_group" {
  source = "Azure/resource-group/azurerm"
  version = "2.0.0"

  resource_group_name = var.resource_group_name
  location            = var.location
}

module "aks" {
  source = "Azure/aks/azurerm"
  version = "8.0.0"

  resource_group_name = module.resource_group.resource_group_name
  location            = module.resource_group.location
}

module "mysql" {
  source = "Azure/mysql/azurerm"
  version = "1.1.0"

  resource_group_name       = module.resource_group.resource_group_name
  location                  = module.resource_group.location
  mysql_server_name         = var.mysql_server_name
  mysql_server_admin        = var.mysql_server_admin
  mysql_server_password     = var.mysql_server_password
  mysql_database_name       = var.mysql_database_name
  mysql_server_version      = var.mysql_server_version
  mysql_storage_mb          = var.mysql_storage_mb
  mysql_backup_retention    = var.mysql_backup_retention
  mysql_geo_redundant_backup= var.mysql_geo_redundant_backup
}
